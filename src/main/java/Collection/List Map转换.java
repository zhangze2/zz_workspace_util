// {libName=教育教学, 
//	 dirs=[
//	 {createTime=2013-04-18 17:04:12, libName=教育教学, ownLib=AES01, ownDir=-1, guuid=AES01-0001, dirName=人才市场分析, creator=admin, sortNum=1},    
//	 {createTime=2013-04-18 17:04:20, libName=教育教学, ownLib=AES01, ownDir=-1, guuid=AES01-0002, dirName=教学设计, creator=admin, sortNum=2}, 
//	 {createTime=2013-04-18 17:04:28, libName=教育教学, ownLib=AES01, ownDir=-1, guuid=AES01-0003, dirName=教学案例, creator=admin, sortNum=3}, 
//	 {createTime=2013-04-18 17:04:36, libName=教育教学, ownLib=AES01, ownDir=-1, guuid=AES01-0004, dirName=教学成果, creator=admin, sortNum=4}, 
//	 {createTime=2013-04-18 17:04:44, libName=教育教学, ownLib=AES01, ownDir=-1, guuid=AES01-0005, dirName=项目管理, creator=admin, sortNum=5}, 
//	 {createTime=2013-04-18 17:04:53, libName=科技应用与研发, ownLib=AES02, ownDir=-1, guuid=AES02-0006, dirName=企业项目研发案例, creator=admin, sortNum=6}, 
//	 {createTime=2013-04-18 17:05:01, libName=科技应用与研发, ownLib=AES02, ownDir=-1, guuid=AES02-0007, dirName=课题申报, creator=admin, sortNum=7}, 
//	 {createTime=2013-04-18 17:05:08, libName=科技应用与研发, ownLib=AES02, ownDir=-1, guuid=AES02-0008, dirName=立项经验, creator=admin, sortNum=8}, 
//	 {createTime=2013-04-18 17:05:16, libName=科技应用与研发, ownLib=AES02, ownDir=-1, guuid=AES02-0009, dirName=科技论文写作, creator=admin, sortNum=9}, 
//	 {createTime=2013-04-18 17:05:23, libName=科技应用与研发, ownLib=AES02, ownDir=-1, guuid=AES02-0010, dirName=学生课题指导, creator=admin, sortNum=10}, 
//	 {createTime=2013-04-19 10:10:16, libName=社会服务, ownLib=AES03, ownDir=-1, guuid=AES03-0011, dirName=服务类, creator=10002, sortNum=11}]}
//
//[
//	{libLocation=AES01, libDesc=教育教学类的归属库, createTime=2013-04-18 17:02:36, libName=教育教学, guuid=AES01, 
//	dirs=[{createTime=2013-04-18 17:04:12, libName=教育教学, ownLib=AES01, ownDir=-1, guuid=AES01-0001, dirName=人才市场分析, creator=admin, sortNum=1}, 
//	      {createTime=2013-04-18 17:04:20, libName=教育教学, ownLib=AES01, ownDir=-1, guuid=AES01-0002, dirName=教学设计, creator=admin, sortNum=2}, 
//	      {createTime=2013-04-18 17:04:28, libName=教育教学, ownLib=AES01, ownDir=-1, guuid=AES01-0003, dirName=教学案例, creator=admin, sortNum=3}, {createTime=2013-04-18 17:04:36, libName=教育教学, ownLib=AES01, ownDir=-1, guuid=AES01-0004, dirName=教学成果, creator=admin, sortNum=4}, {createTime=2013-04-18 17:04:44, libName=教育教学, ownLib=AES01, ownDir=-1, guuid=AES01-0005, dirName=项目管理, creator=admin, sortNum=5}], creator=admin}, {libLocation=AES02, libDesc=科技应用与研发相关资源归属库, createTime=2013-04-18 17:03:21, libName=科技应用与研发, guuid=AES02, dirs=[{createTime=2013-04-18 17:04:53, libName=科技应用与研发, ownLib=AES02, ownDir=-1, guuid=AES02-0006, dirName=企业项目研发案例, creator=admin, sortNum=6}, {createTime=2013-04-18 17:05:01, libName=科技应用与研发, ownLib=AES02, ownDir=-1, guuid=AES02-0007, dirName=课题申报, creator=admin, sortNum=7}, {createTime=2013-04-18 17:05:08, libName=科技应用与研发, ownLib=AES02, ownDir=-1, guuid=AES02-0008, dirName=立项经验, creator=admin, sortNum=8}, {createTime=2013-04-18 17:05:16, libName=科技应用与研发, ownLib=AES02, ownDir=-1, guuid=AES02-0009, dirName=科技论文写作, creator=admin, sortNum=9}, {createTime=2013-04-18 17:05:23, libName=科技应用与研发, ownLib=AES02, ownDir=-1, guuid=AES02-0010, dirName=学生课题指导, creator=admin, sortNum=10}], creator=admin}, {libLocation=AES03, libDesc=我的测试, createTime=2013-04-19 10:08:56, libName=社会服务, guuid=AES03, dirs=[{createTime=2013-04-19 10:10:16, libName=社会服务, ownLib=AES03, ownDir=-1, guuid=AES03-0011, dirName=服务类, creator=10002, sortNum=11}], creator=10002}]
//// 数据表
//List<Map<String, Object>>转换
//
//[{
//	libLocation=null, libDesc=null, createTime=2013-04-10 11:13:01, libName=教育教学, rn=1, guuid=AES01, 
//	dirs=[
//			{libName=教育教学, dirName=人才市场分析}, 
//			{libName=教育教学, dirName=教学设计}
//	     ], 
//	creator=admin
// }, 
//{libLocation=null, libDesc=null, createTime=2013-04-10 11:13:18, libName=科技应用与研发, rn=2, guuid=AES02, 
//	dirs=[{libName=科技应用与研发, dirName=企业项目研发案例}], 
//	creator=admin
//}, 
//{libLocation=null, libDesc=null, createTime=2013-04-10 11:13:29, libName=社会服务, rn=3, guuid=AES03, 
//	dirs=[{libName=社会服务, dirName=校企合作项目管理}], 
//	creator=admin},
//			 null, null, null, null, null, null, null]

// 例子1:首页资源分类导航
@InvokeAnnotation(name = "home_list_dir", 
		paramsName = { "ownLib" }, 
		paramsType = { ValueType.STRING }, 
		returnType = ValueType.MAP)
public Map<String, Object> home_list_dir(final String ownLib) {
	List<Map<String, Object>> libs = getInitializer().getButterflyTemplate().execute(
			new JdbcCallback<List<Map<String, Object>>>() {
				@Override
				public List<Map<String, Object>> doInConnection(IDaos idaos)
				throws Exception {
					return libDao.findLibList(idaos, 0, 50);// 列出所有资源库
				}
	});
	Map<String, Object> map = new HashMap<String, Object>();
	for(int i = libs.size() - 1; i>=0; i--) {
		String libName = (String) libs.get(i).get("libName");// 该资源库的名称
		List<Map<String, Object>> libNameList = (List<Map<String, Object>>) ComponentJsonUtils.fromJson(libName, List.class);//将模板步骤转换为list形式
		libNameList.add("libName",libNameList);
		List<Map<String, Object>> dirs =  getInitializer().getButterflyTemplate().execute(new 
				JdbcCallback<List<Map<String, Object>>>() {
			@Override
			public List<Map<String, Object>> doInConnection(IDaos idaos)
				throws Exception {
				return dao.homeListDir(idaos, ownLib);	// 找到该资源库下的所有一级目录List
			}
		});
		libNameMap.put("dirs", dirs);
	}
	return map;
}


// 例子2
@InvokeAnnotation(name = "detail_proj", 
			paramsName = { "guuid" }, 
			paramsType = { ValueType.STRING }, 
			returnType = ValueType.MAP)
	public Map<String, Object> detail_proj(final String guuid) {
		Map<String, Object> proj = getInitializer().getButterflyTemplate().execute(new 
				JdbcCallback<Map<String, Object>>() {
			@Override
			public Map<String, Object> doInConnection(IDaos idaos)
				throws Exception {
				return projDao.findOne(idaos, guuid);//找出该项目
			}
		});
		final String  ownProj = (String) proj.get("guuid");//获取项目ID
		final String templateId = (String) proj.get("templateId");//获取该项目采用的模板ID
		String def = getInitializer().getButterflyTemplate().execute(new JdbcCallback<String>() {
			@Override
			public String doInConnection(IDaos idaos) throws Exception {
				return templateDao.findDef(idaos, templateId);//找出采用的模板的步骤
			}
		});
		List<Map<String, Object>> list = new ArrayList<Map<String, Object>>();
		@SuppressWarnings("unchecked")
		List<Map<String, Object>> defs = (List<Map<String, Object>>) ComponentJsonUtils.fromJson(def, List.class);//将模板步骤转换为list形式
		for (int i = defs.size() - 1; i >= 0; i--) {
			Map<String, Object> stepMap = new HashMap<String,Object>();//存该项目下不同步骤的资源
			 final Integer step = (Integer) defs.get(i).get("step");
			 List<Map<String, Object>> sList =getInitializer().getButterflyTemplate().execute(//同一步骤下的资源
					 new JdbcCallback<List<Map<String, Object>>>() {
				@Override
				public List<Map<String, Object>> doInConnection(IDaos idaos)
						throws Exception {
					return resDao.findResProj(idaos, ownProj, step);//查找属于该项目该步骤的资源
				}
			});
			stepMap.put("step", step);
			stepMap.put("stepName", (String) defs.get(i).get("def"));
			stepMap.put("content", sList);
			list.add(stepMap);
		}
		proj.put("res",list);
		return proj;
	}